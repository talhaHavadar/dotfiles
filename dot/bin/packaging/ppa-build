#!/usr/bin/env bash
set -ex

TMP_DIR="$(mktemp -u -d -p ..)"
CURRENT_DIR="$(basename $(pwd))"

cp -R ../${CURRENT_DIR} ${TMP_DIR}
cd "${TMP_DIR}"
packaging dch-auto
debuild --no-conf -S -d -sa
SOURCE_CHANGES_FILE="$(dpkg-parsechangelog -SSource)_$(dpkg-parsechangelog -SVersion)_source.changes"
cd -
rm -rf "${TMP_DIR}"
dput -f "ppa:$1" "../${SOURCE_CHANGES_FILE}"
